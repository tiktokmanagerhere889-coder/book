"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4707],{4489(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"modules/ros2-humanoid-control/chapter-2-python-agents-rclpy","title":"Chapter 2: Python Agents with rclpy","description":"Writing ROS 2 nodes in Python and bridging AI logic to robot controllers","source":"@site/docs/modules/ros2-humanoid-control/chapter-2-python-agents-rclpy.md","sourceDirName":"modules/ros2-humanoid-control","slug":"/modules/ros2-humanoid-control/chapter-2-python-agents-rclpy","permalink":"/book/ur/docs/modules/ros2-humanoid-control/chapter-2-python-agents-rclpy","draft":false,"unlisted":false,"editUrl":"https://github.com/hassan/book/tree/master/docs/docs/modules/ros2-humanoid-control/chapter-2-python-agents-rclpy.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Chapter 2: Python Agents with rclpy","description":"Writing ROS 2 nodes in Python and bridging AI logic to robot controllers"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: ROS 2 Fundamentals","permalink":"/book/ur/docs/modules/ros2-humanoid-control/chapter-1-ros2-fundamentals"},"next":{"title":"Chapter 3: Humanoid Modeling with URDF","permalink":"/book/ur/docs/modules/ros2-humanoid-control/chapter-3-urdf-modeling"}}');var i=s(4848),t=s(8453);const o={sidebar_position:3,title:"Chapter 2: Python Agents with rclpy",description:"Writing ROS 2 nodes in Python and bridging AI logic to robot controllers"},l="Chapter 2: Python Agents with rclpy",a={},c=[{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"Setting Up Your First rclpy Node",id:"setting-up-your-first-rclpy-node",level:2},{value:"Publishers and Subscribers",id:"publishers-and-subscribers",level:2},{value:"Publishers",id:"publishers",level:3},{value:"Subscribers",id:"subscribers",level:3},{value:"Services in Python",id:"services-in-python",level:2},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Bridging AI Logic to Robot Controllers",id:"bridging-ai-logic-to-robot-controllers",level:2},{value:"AI Agent Node",id:"ai-agent-node",level:3},{value:"Working with Parameters",id:"working-with-parameters",level:2},{value:"Best Practices for Python ROS 2 Development",id:"best-practices-for-python-ros-2-development",level:2},{value:"1. Error Handling",id:"1-error-handling",level:3},{value:"2. Resource Cleanup",id:"2-resource-cleanup",level:3},{value:"3. Threading Considerations",id:"3-threading-considerations",level:3},{value:"Integrating with AI Libraries",id:"integrating-with-ai-libraries",level:2},{value:"Summary",id:"summary",level:2},{value:"Learning Objectives Review",id:"learning-objectives-review",level:2},{value:"Previous and Next Steps",id:"previous-and-next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-2-python-agents-with-rclpy",children:"Chapter 2: Python Agents with rclpy"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"rclpy"})," is the Python client library for ROS 2, providing Python bindings for the ROS 2 middleware. It allows Python developers to create ROS 2 nodes, publish and subscribe to topics, and make service calls, making it an excellent choice for AI engineers who prefer Python for developing intelligent agents."]}),"\n",(0,i.jsxs)(n.p,{children:["Python's simplicity and rich ecosystem of AI libraries make ",(0,i.jsx)(n.code,{children:"rclpy"})," a powerful tool for bridging AI algorithms to robot control systems."]}),"\n",(0,i.jsx)(n.h2,{id:"setting-up-your-first-rclpy-node",children:"Setting Up Your First rclpy Node"}),"\n",(0,i.jsx)(n.p,{children:"To create a basic ROS 2 node in Python, you'll need to import the necessary modules and implement the basic node structure:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MinimalPublisher(Node):\n\n    def __init__(self):\n        super().__init__('minimal_publisher')\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = 'Hello World: %d' % self.i\n        self.publisher_.publish(msg)\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    minimal_publisher = MinimalPublisher()\n\n    rclpy.spin(minimal_publisher)\n\n    minimal_publisher.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"publishers-and-subscribers",children:"Publishers and Subscribers"}),"\n",(0,i.jsx)(n.h3,{id:"publishers",children:"Publishers"}),"\n",(0,i.jsx)(n.p,{children:"Publishers send data to topics. Here's an example of creating a publisher that sends sensor data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float32\n\nclass SensorPublisher(Node):\n\n    def __init__(self):\n        super().__init__('sensor_publisher')\n        self.publisher_ = self.create_publisher(Float32, 'sensor_data', 10)\n\n        # Simulate sensor readings every 0.1 seconds\n        self.timer = self.create_timer(0.1, self.publish_sensor_data)\n        self.sensor_value = 0.0\n\n    def publish_sensor_data(self):\n        msg = Float32()\n        # In a real system, this would come from an actual sensor\n        msg.data = self.sensor_value\n        self.publisher_.publish(msg)\n        self.sensor_value += 0.1  # Simulate changing sensor value\n"})}),"\n",(0,i.jsx)(n.h3,{id:"subscribers",children:"Subscribers"}),"\n",(0,i.jsx)(n.p,{children:"Subscribers receive data from topics. Here's an example of creating a subscriber:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass SensorSubscriber(Node):\n\n    def __init__(self):\n        super().__init__('sensor_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'topic',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg):\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"services-in-python",children:"Services in Python"}),"\n",(0,i.jsx)(n.p,{children:"Services provide synchronous request-reply communication. Here's how to implement a service server and client:"}),"\n",(0,i.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalService(Node):\n\n    def __init__(self):\n        super().__init__('minimal_service')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))\n        return response\n"})}),"\n",(0,i.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass MinimalClientAsync(Node):\n\n    def __init__(self):\n        super().__init__('minimal_client_async')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"bridging-ai-logic-to-robot-controllers",children:"Bridging AI Logic to Robot Controllers"}),"\n",(0,i.jsx)(n.p,{children:"One of the key benefits of ROS 2 is its ability to connect AI algorithms with robot control systems. Here's an example of how to bridge AI decision-making with robot control:"}),"\n",(0,i.jsx)(n.h3,{id:"ai-agent-node",children:"AI Agent Node"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom geometry_msgs.msg import Twist\n\nclass AIAgent(Node):\n    """\n    An AI agent that makes decisions based on sensor input\n    and sends commands to the robot controller\n    """\n\n    def __init__(self):\n        super().__init__(\'ai_agent\')\n\n        # Subscribe to sensor data\n        self.sensor_subscription = self.create_subscription(\n            String,\n            \'sensor_input\',\n            self.sensor_callback,\n            10)\n\n        # Publish commands to robot controller\n        self.cmd_publisher = self.create_publisher(Twist, \'cmd_vel\', 10)\n\n        self.current_sensor_data = None\n\n    def sensor_callback(self, msg):\n        """Process incoming sensor data"""\n        self.current_sensor_data = msg.data\n        self.make_decision()\n\n    def make_decision(self):\n        """AI logic to determine robot action"""\n        if self.current_sensor_data:\n            cmd_msg = Twist()\n\n            # Simple AI logic: if sensor detects obstacle, stop or turn\n            if \'obstacle\' in self.current_sensor_data.lower():\n                cmd_msg.linear.x = 0.0  # Stop linear motion\n                cmd_msg.angular.z = 0.5  # Turn right\n            else:\n                cmd_msg.linear.x = 0.5  # Move forward\n                cmd_msg.angular.z = 0.0  # No turning\n\n            # Send command to robot controller\n            self.cmd_publisher.publish(cmd_msg)\n            self.get_logger().info(f\'Sent command: linear={cmd_msg.linear.x}, angular={cmd_msg.angular.z}\')\n'})}),"\n",(0,i.jsx)(n.h2,{id:"working-with-parameters",children:"Working with Parameters"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 nodes can accept parameters that can be configured at runtime:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass ParameterNode(Node):\n\n    def __init__(self):\n        super().__init__('parameter_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('max_speed', 1.0)\n        self.declare_parameter('safety_distance', 0.5)\n\n        # Access parameter values\n        self.max_speed = self.get_parameter('max_speed').value\n        self.safety_distance = self.get_parameter('safety_distance').value\n\n        self.get_logger().info(f'Max speed: {self.max_speed}, Safety distance: {self.safety_distance}')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices-for-python-ros-2-development",children:"Best Practices for Python ROS 2 Development"}),"\n",(0,i.jsx)(n.h3,{id:"1-error-handling",children:"1. Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"Always include proper error handling in your nodes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def timer_callback(self):\n    try:\n        # Your node logic here\n        processed_data = self.process_sensor_data()\n        self.publisher_.publish(processed_data)\n    except Exception as e:\n        self.get_logger().error(f'Error in timer callback: {str(e)}')\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-resource-cleanup",children:"2. Resource Cleanup"}),"\n",(0,i.jsx)(n.p,{children:"Ensure proper cleanup of resources:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def destroy_node(self):\n    # Clean up timers, publishers, subscribers\n    if hasattr(self, 'timer') and self.timer is not None:\n        self.timer.cancel()\n    super().destroy_node()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-threading-considerations",children:"3. Threading Considerations"}),"\n",(0,i.jsx)(n.p,{children:"Be aware of threading issues in ROS 2 Python nodes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# For CPU-intensive tasks, consider using a separate thread\nimport threading\nfrom rclpy.executors import MultiThreadedExecutor\n\ndef cpu_intensive_task(self):\n    # Move heavy computation to a separate thread\n    thread = threading.Thread(target=self.heavy_computation)\n    thread.start()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"integrating-with-ai-libraries",children:"Integrating with AI Libraries"}),"\n",(0,i.jsxs)(n.p,{children:["Python's rich AI ecosystem integrates seamlessly with ",(0,i.jsx)(n.code,{children:"rclpy"}),". Here's an example using TensorFlow for perception:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nimport tensorflow as tf\nfrom sensor_msgs.msg import Image\nfrom std_msgs.msg import String\nimport numpy as np\n\nclass AIPerceptionNode(Node):\n\n    def __init__(self):\n        super().__init__('ai_perception_node')\n\n        # Load pre-trained model\n        self.model = tf.keras.models.load_model('/path/to/model')\n\n        # Subscribe to camera data\n        self.image_subscription = self.create_subscription(\n            Image,\n            'camera_image',\n            self.image_callback,\n            10)\n\n        # Publish recognition results\n        self.result_publisher = self.create_publisher(String, 'recognition_result', 10)\n\n    def image_callback(self, msg):\n        # Convert ROS image message to format for TensorFlow\n        image_data = self.convert_ros_image_to_numpy(msg)\n\n        # Run inference\n        prediction = self.model.predict(np.expand_dims(image_data, axis=0))\n\n        # Publish result\n        result_msg = String()\n        result_msg.data = f'Detected object: {prediction}'\n        self.result_publisher.publish(result_msg)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, we've explored:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Creating ROS 2 nodes using the ",(0,i.jsx)(n.code,{children:"rclpy"})," Python client library"]}),"\n",(0,i.jsx)(n.li,{children:"Implementing publishers and subscribers for asynchronous communication"}),"\n",(0,i.jsx)(n.li,{children:"Setting up services for synchronous request-reply communication"}),"\n",(0,i.jsx)(n.li,{children:"Bridging AI logic to robot controllers using ROS 2 messaging"}),"\n",(0,i.jsx)(n.li,{children:"Working with parameters for configurable behavior"}),"\n",(0,i.jsx)(n.li,{children:"Best practices for developing robust Python nodes"}),"\n",(0,i.jsx)(n.li,{children:"Integrating AI libraries with ROS 2 systems"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The combination of Python's ease of use and ROS 2's distributed architecture makes ",(0,i.jsx)(n.code,{children:"rclpy"})," an excellent choice for implementing AI agents that interact with robotic systems."]}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives-review",children:"Learning Objectives Review"}),"\n",(0,i.jsx)(n.p,{children:"After completing this chapter, you should be able to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create ROS 2 nodes in Python using rclpy"}),"\n",(0,i.jsx)(n.li,{children:"Implement publishers, subscribers, and services in Python"}),"\n",(0,i.jsx)(n.li,{children:"Bridge AI logic to robot controllers using ROS 2 messaging"}),"\n",(0,i.jsx)(n.li,{children:"Apply best practices for Python ROS 2 development"}),"\n",(0,i.jsx)(n.li,{children:"Integrate AI libraries with ROS 2 systems"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"previous-and-next-steps",children:"Previous and Next Steps"}),"\n",(0,i.jsxs)(n.p,{children:["Previous: ",(0,i.jsx)(n.a,{href:"/book/ur/docs/modules/ros2-humanoid-control/chapter-1-ros2-fundamentals",children:"Chapter 1: ROS 2 Fundamentals"})]}),"\n",(0,i.jsxs)(n.p,{children:["Continue to ",(0,i.jsx)(n.a,{href:"/book/ur/docs/modules/ros2-humanoid-control/chapter-3-urdf-modeling",children:"Chapter 3: Humanoid Modeling with URDF"})," to learn about Unified Robot Description Format and its role in ROS 2."]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);